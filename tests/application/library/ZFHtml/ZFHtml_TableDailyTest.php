<?php
/**
 * Test class for ZFHtml_TableDaily.
 * Generated by PHPUnit on 2010-04-04 at 03:05:13.
 */
class ZFHtml_TableDailyTest extends ControllerTestCase {

	public function setUp() {
		parent::setup();
		$this->dataSetStackBuffer = array('users'=>1);
		$this->loadDataSets();
	}

	/**
	 * Tears down the fixture, for example, closes a network connection.
	 * This method is called after a test is executed.
	 */
	public function tearDown() {
		$this->unLoadDataSets();
	}

	public function testYield() {
		
		$this->login('jvazquez','Test1234');
		$start = date('Y-m-d',mktime(null, null, null, 04, 1,date('Y')));
		$end = date('Y-m-d',mktime(null, null, null, 04, 30,date('Y')));
		$this->login('jvazquez', 'Test1234');
		$this->request->setMethod('POST')
		->setPost(array(
                'title' => 'fooTitle',
                'data' => 'Data for a fake tests',
                'allDayEvent' => 0,
                'startDate' => $start,
                'endDate' => $end,
                'startTime' => '09:0:00',
                'endTime' => '10:30:00',
                'attendees'=>array(0=>2,1=>3)
		)
		);
		$this->dispatch('calendar/create');
		$this->resetRequest()
			 ->resetResponse();
		$options = array('userid'=>1);
		$object = new ZFHtml_TableDaily($options);
		$result = $object->yield();
		$this->assertTrue(strlen($result)>10);
	}

	public function testGlueElementsReturnsWrappedLink() {
		
		$options = array('userid'=>1);
		$table = new ZFHtml_TableDaily($options);
		$recordset = array('id'=>1,'title'=>'test','allDayEvent'=>0,'startTime'=>'16:00','pivotMinute'=>'00','endTime'=>'17:00:00','startDate'=>'2010-07-28','endDate'=>'2010-07-28','domId'=>'2010-07-28-16:00');
		$result = $table->glueElements($recordset);
		$this->assertTrue($result!==null,'Result was null');
	}
	
	/**
	 * @test
	 */
	public function domTestingInPhp()
	{
		$stringHtml = "<span id=\"link-2010-09-18-16:00\" class=\"regular\"><a href=\"/calendar/view/viewevent/id/4\">fooTitle</a></span>";
		$dom = new DOMDocument();
		$dom->strictErrorChecking = false;
        $dom->loadHTML($stringHtml);
        $xpath = new DOMXpath($dom);
        $nodeFoundXpath = $xpath->query('//*[@id="link-2010-09-18-16:00"]');
        $this->assertNotNull($nodeFoundXpath,'Xpath failed also');
	}
}
?>
